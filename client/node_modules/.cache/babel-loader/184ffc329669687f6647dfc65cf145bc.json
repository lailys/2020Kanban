{"ast":null,"code":"import _classCallCheck from\"/Users/lailysarvarian/a-kanban/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/lailysarvarian/a-kanban/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/lailysarvarian/a-kanban/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/lailysarvarian/a-kanban/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{findDOMNode}from\"react-dom\";import{DragSource,DropTarget}from\"react-dnd\";import flow from\"lodash/flow\";import{Link}from\"react-router-dom\";import opensocket from\"socket.io-client\";import moment from\"moment\";var Card=/*#__PURE__*/function(_Component){_inherits(Card,_Component);var _super=_createSuper(Card);function Card(){var _this;_classCallCheck(this,Card);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={members:[],deadline:\"\",display:\"none\"};_this.componentDidMount=function(){var socket=opensocket(\"http://localhost:8080\");_this.fetchMembers();_this.setState({deadline:!_this.props.card.deadline?\"\":moment(_this.props.card.deadline).format(\"MMMM Do YYYY, HH:mm a \")});socket.on(\"taskMember\",function(data){if(data.action===\"create\"){_this.fetchMembers();}});};_this.fetchMembers=function(){fetch(\"/task-members/\".concat(_this.props.card._id),{headers:{Authorization:\"Bearer \"}}).then(function(res){return res.json();}).then(function(result){_this.setState({members:result.members});});};_this.renderRemove=function(){return _this.props.token?/*#__PURE__*/React.createElement(\"span\",{id:\"user-page-span\",onClick:function onClick(e){return _this.props.removeTask(e,_this.props.card.team,_this.props.card._id,_this.props.card.stage,_this.props.position);}},\"-\"):/*#__PURE__*/React.createElement(\"span\",null);};_this.displayModal=function(e){_this.state.display===\"flex\"?_this.setState({display:\"none\"}):_this.setState({display:\"flex\"});};_this.removeTask=function(e){if(_this.props.token){fetch(\"/tasks/\".concat(_this.props.id),{method:\"DELETE\",headers:{Authorization:\"Bearer \"+_this.props.token,\"Content-Type\":\"application/json\"},body:JSON.stringify({user:localStorage.getItem(\"userId\"),team:_this.props.card.team,task:_this.props.id,stage:_this.props.card.stage,i:_this.props.position})}).then(function(result){return result.json();}).then(function(res){if(!res.done){alert(res.message);}});}else{_this.props.history.push(\"/login\");}};return _this;}_createClass(Card,[{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,card=_this$props.card,isDragging=_this$props.isDragging,connectDragSource=_this$props.connectDragSource,connectDropTarget=_this$props.connectDropTarget;var members=this.state.members;var opacity=isDragging?0.5:1;return connectDragSource(connectDropTarget(/*#__PURE__*/React.createElement(\"div\",{className:\"task-cube\",id:\"id-\".concat(this.props.id,\"+\").concat(this.props.position),style:{opacity:opacity},index:\"whatttt\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-bookmark\",id:\"bookmark-\".concat(this.props.id,\"+\").concat(this.props.position),style:{color:card.priority}}),/*#__PURE__*/React.createElement(\"div\",{className:\"task-title\",id:\"cube-\".concat(this.props.id,\"+\").concat(this.props.position)},card.title.toUpperCase()),/*#__PURE__*/React.createElement(\"div\",{className:\"task-cube-middle\"},/*#__PURE__*/React.createElement(Link,{id:\"link\",className:\"fas fa-question\",to:\"/\".concat(this.props.team.title,\"/\").concat(card._id)}),/*#__PURE__*/React.createElement(\"div\",{className:\"member-count\"},/*#__PURE__*/React.createElement(\"div\",{className:\"member-sign\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-user-friends\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"count\"},card.responders.length)),this.props.card.deadline?/*#__PURE__*/React.createElement(\"div\",{className:\"deadline\"},/*#__PURE__*/React.createElement(\"div\",{className:\"background\"}),/*#__PURE__*/React.createElement(\"div\",{id:\"cube-deadline\",style:{opacity:this.state.timeOpacity}},!this.props.card.deadline?\"\":moment(this.props.card.deadline).format(\"MMMM Do YYYY, HH:mm a \")),/*#__PURE__*/React.createElement(\"div\",{className:\"fas fa-clock\",onMouseOver:function onMouseOver(e){_this2.setState({timeOpacity:\"1\"});},onMouseLeave:function onMouseLeave(e){_this2.setState({timeOpacity:\"0\"});}})):/*#__PURE__*/React.createElement(\"div\",{className:\"deadline\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"members-container\"},this.props.card.responders.map(function(member,i){var style={};style={position:\"absolute\",right:\"\".concat(i*2,\"vh\"),top:\"0\",backgroundImage:\"none\",color:\"white\",backgroundColor:member.color};return/*#__PURE__*/React.createElement(\"div\",{key:\"img-\".concat(i),className:\"task-img\",style:style},/*#__PURE__*/React.createElement(\"div\",null,\"\".concat(member.name.split(\" \")[0][0].toUpperCase(),\"\\n                        \").concat(member.name.split(\" \")[1][0].toUpperCase())));})))));}}]);return Card;}(Component);var cardSource={beginDrag:function beginDrag(props,monitor,component){var hoverBoundingRect=findDOMNode(component).getBoundingClientRect();return{index:props.index,listId:props.listId,card:props.card,cardBottom:hoverBoundingRect.bottom,cardTop:hoverBoundingRect.top};},endDrag:function endDrag(props,monitor){var item=monitor.getItem();var dropResult=monitor.getDropResult();if(dropResult&&dropResult.listId!==item.listId){props.removeCard(item.index);}}};var cardTarget={hover:function hover(props,monitor,component){var dragIndex=monitor.getItem().index;var hoverIndex=props.index;var sourceListId=monitor.getItem().listId;var draggedItem=monitor.getItem().card;var draggedBottom=monitor.getItem().cardBottom;var draggedTop=monitor.getItem().cardTop;// Don't replace items with themselves\nif(dragIndex===hoverIndex){return;}var draggedHeight=draggedBottom-draggedTop;// Determine rectangle on screen\nvar hoverBoundingRect=findDOMNode(component).getBoundingClientRect();// Get vertical middle\nvar hoverY=hoverBoundingRect.bottom-hoverBoundingRect.top;// Determine mouse position\nvar clientOffset=monitor.getClientOffset();// Get pixels to the top\nvar hoverClientY=clientOffset.y-hoverBoundingRect.top;// Dragging downwards\nif(dragIndex<hoverIndex&&hoverClientY<hoverY/400){return;}// Dragging upwards\nif(dragIndex>hoverIndex&&hoverClientY/4>hoverY){return;}if(props.listId===sourceListId){props.moveCard(dragIndex,hoverIndex,draggedItem);monitor.getItem().index=hoverIndex;}}};export default flow(DropTarget(\"CARD\",cardTarget,function(connect){return{connectDropTarget:connect.dropTarget()};}),DragSource(\"CARD\",cardSource,function(connect,monitor){return{connectDragSource:connect.dragSource(),isDragging:monitor.isDragging()};}))(Card);","map":{"version":3,"sources":["/Users/lailysarvarian/a-kanban/client/src/components/Card.js"],"names":["React","Component","findDOMNode","DragSource","DropTarget","flow","Link","opensocket","moment","Card","state","members","deadline","display","componentDidMount","socket","fetchMembers","setState","props","card","format","on","data","action","fetch","_id","headers","Authorization","then","res","json","result","renderRemove","token","e","removeTask","team","stage","position","displayModal","id","method","body","JSON","stringify","user","localStorage","getItem","task","i","done","alert","message","history","push","isDragging","connectDragSource","connectDropTarget","opacity","color","priority","title","toUpperCase","responders","length","timeOpacity","map","member","style","right","top","backgroundImage","backgroundColor","name","split","cardSource","beginDrag","monitor","component","hoverBoundingRect","getBoundingClientRect","index","listId","cardBottom","bottom","cardTop","endDrag","item","dropResult","getDropResult","removeCard","cardTarget","hover","dragIndex","hoverIndex","sourceListId","draggedItem","draggedBottom","draggedTop","draggedHeight","hoverY","clientOffset","getClientOffset","hoverClientY","y","moveCard","connect","dropTarget","dragSource"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { findDOMNode } from \"react-dom\";\nimport { DragSource, DropTarget } from \"react-dnd\";\nimport flow from \"lodash/flow\";\nimport { Link } from \"react-router-dom\";\nimport opensocket from \"socket.io-client\";\nimport moment from \"moment\";\n\n\n\nclass Card extends Component {\n  state = {\n    members: [],\n    deadline: \"\",\n    display: \"none\",\n  };\n  componentDidMount = () => {\n    const socket = opensocket(\"http://localhost:8080\");\n    this.fetchMembers();\n    this.setState({\n      deadline: !this.props.card.deadline\n        ? \"\"\n        : moment(this.props.card.deadline).format(\"MMMM Do YYYY, HH:mm a \"),\n    });\n    socket.on(\"taskMember\", (data) => {\n      if (data.action === \"create\") {\n        this.fetchMembers();\n      }\n    });\n  };\n  fetchMembers = () => {\n    fetch(`/task-members/${this.props.card._id}`, {\n      headers: {\n        Authorization: \"Bearer \",\n      },\n    })\n      .then((res) => {\n        return res.json();\n      })\n      .then((result) => {\n        this.setState({ members: result.members });\n      });\n  };\n  renderRemove = () => {\n    return this.props.token ? (\n      <span\n        id=\"user-page-span\"\n        onClick={(e) =>\n          this.props.removeTask(\n            e,\n            this.props.card.team,\n            this.props.card._id,\n            this.props.card.stage,\n            this.props.position\n          )\n        }\n      >\n        -\n      </span>\n    ) : (\n      <span></span>\n    );\n  };\n  displayModal = (e) => {\n    this.state.display === \"flex\"\n      ? this.setState({ display: \"none\" })\n      : this.setState({ display: \"flex\" });\n  };\n  removeTask = (e) => {\n    if (this.props.token) {\n      fetch(`/tasks/${this.props.id}`, {\n        method: \"DELETE\",\n        headers: {\n          Authorization: \"Bearer \" + this.props.token,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          user: localStorage.getItem(\"userId\"),\n          team: this.props.card.team,\n          task: this.props.id,\n          stage: this.props.card.stage,\n          i: this.props.position,\n        }),\n      })\n        .then((result) => {\n          return result.json();\n        })\n        .then((res) => {\n          if (!res.done) {\n            alert(res.message);\n          }\n        });\n    } else {\n      this.props.history.push(\"/login\");\n    }\n  };\n  render() {\n    const {\n      card,\n      isDragging,\n      connectDragSource,\n      connectDropTarget,\n    } = this.props;\n    const members=this.state.members\n    const opacity = isDragging ? 0.5 : 1;\n    return connectDragSource(\n      connectDropTarget(\n          <div\n            className=\"task-cube\"\n            id={`id-${this.props.id}+${this.props.position}`}\n            style={{  opacity }}\n            index=\"whatttt\"\n          >\n            <i\n              className=\"fas fa-bookmark\"\n              id={`bookmark-${this.props.id}+${this.props.position}`}\n              style={{ color: card.priority }}\n            ></i>\n            <div\n              className=\"task-title\"\n              id={`cube-${this.props.id}+${this.props.position}`}\n            >\n              {card.title.toUpperCase()}\n            </div>\n            <div className=\"task-cube-middle\">\n              <Link\n                id=\"link\"\n                className=\"fas fa-question\"\n                to={`/${this.props.team.title}/${card._id}`}\n              ></Link>\n              <div className=\"member-count\">\n                <div className=\"member-sign\">\n                  <i className=\"fas fa-user-friends\"></i>\n                </div>\n                <div className=\"count\">{card.responders.length}</div>\n              </div>\n              {this.props.card.deadline ? (\n                <div className=\"deadline\">\n                  <div className=\"background\"></div>\n                  <div\n                    id=\"cube-deadline\"\n                    style={{ opacity: this.state.timeOpacity }}\n                  >\n                    {!this.props.card.deadline\n                      ? \"\"\n                      : moment(this.props.card.deadline).format(\n                          \"MMMM Do YYYY, HH:mm a \"\n                        )}\n                  </div>\n                  <div\n                    className=\"fas fa-clock\"\n                    onMouseOver={(e) => {\n                      this.setState({ timeOpacity: \"1\" });\n                    }}\n                    onMouseLeave={(e) => {\n                      this.setState({ timeOpacity: \"0\" });\n                    }}\n                  />\n                </div>\n              ) : (\n                <div className=\"deadline\"></div>\n              )}\n            </div>\n            <div className=\"members-container\">\n              {this.props.card.responders.map((member, i) => {\n                let style = {};\n                  (style = {\n                      position: \"absolute\",\n                      right: `${i * 2}vh`,\n                      top: \"0\",\n                      backgroundImage: \"none\",\n                      color: \"white\",\n                      backgroundColor: member.color,\n                    });\n                return(\n                  <div key={`img-${i}`} className=\"task-img\" style={style}>\n                    <div>\n                      {\n                        `${member.name.split(\" \")[0][0].toUpperCase()}\n                        ${member.name.split(\" \")[1][0].toUpperCase()}`\n                        }\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )\n    );\n  }\n}\nconst cardSource = {\n  beginDrag(props,monitor, component) {\n    const hoverBoundingRect = findDOMNode(component).getBoundingClientRect();\n    return {\n      index: props.index,\n      listId: props.listId,\n      card: props.card,\n      cardBottom:hoverBoundingRect.bottom,\n      cardTop:hoverBoundingRect.top\n    };\n  },\n  endDrag(props, monitor) {\n    const item = monitor.getItem();\n    const dropResult = monitor.getDropResult();\n    if (dropResult && dropResult.listId !== item.listId) {\n      props.removeCard(item.index);\n    }\n  },\n};\nconst cardTarget = {\n  hover(props, monitor, component) {\n    const dragIndex = monitor.getItem().index;\n    const hoverIndex = props.index;\n    const sourceListId = monitor.getItem().listId;\n    const draggedItem = monitor.getItem().card;\n    const draggedBottom = monitor.getItem().cardBottom;\n    const draggedTop = monitor.getItem().cardTop;\n    // Don't replace items with themselves\n    if (dragIndex === hoverIndex) {\n      return;\n    }\n    const draggedHeight=draggedBottom-draggedTop\n    // Determine rectangle on screen\n    const hoverBoundingRect = findDOMNode(component).getBoundingClientRect();\n    // Get vertical middle\n    const hoverY = (hoverBoundingRect.bottom - hoverBoundingRect.top) ;\n    // Determine mouse position\n    const clientOffset = monitor.getClientOffset();\n    // Get pixels to the top\n    const hoverClientY = (clientOffset.y - hoverBoundingRect.top);\n    // Dragging downwards\n    if (dragIndex < hoverIndex && hoverClientY < hoverY/400) {\n      return;\n    }\n    // Dragging upwards\n    if (dragIndex > hoverIndex && (hoverClientY/4) > hoverY) {\n      return;\n    }\n    if (props.listId === sourceListId) {\n      props.moveCard(dragIndex, hoverIndex, draggedItem);\n      monitor.getItem().index = hoverIndex;\n    }\n  },\n};\nexport default flow(\n  DropTarget(\"CARD\", cardTarget, (connect) => ({\n    connectDropTarget: connect.dropTarget(),\n  })),\n  DragSource(\"CARD\", cardSource, (connect, monitor) => ({\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }))\n)(Card);\n"]},"metadata":{},"sourceType":"module"}