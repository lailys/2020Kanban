{"ast":null,"code":"\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar EnterLeaveCounter_1 = require(\"./EnterLeaveCounter\");\n\nvar BrowserDetector_1 = require(\"./BrowserDetector\");\n\nvar OffsetUtils_1 = require(\"./OffsetUtils\");\n\nvar NativeDragSources_1 = require(\"./NativeDragSources\");\n\nvar NativeTypes = require(\"./NativeTypes\");\n\nvar autobind_decorator_1 = require(\"autobind-decorator\");\n\nvar defaults = require('lodash/defaults');\n\nvar shallowEqual = require('shallowequal');\n\nvar HTML5Backend =\n/** @class */\nfunction () {\n  function HTML5Backend(manager) {\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.sourceNodes = new Map();\n    this.sourceNodeOptions = new Map();\n    this.enterLeaveCounter = new EnterLeaveCounter_1.default();\n    this.dragStartSourceIds = null;\n    this.dropTargetIds = [];\n    this.dragEnterTargetIds = [];\n    this.currentNativeSource = null;\n    this.currentNativeHandle = null;\n    this.currentDragSourceNode = null;\n    this.currentDragSourceNodeOffset = null;\n    this.currentDragSourceNodeOffsetChanged = false;\n    this.altKeyPressed = false;\n    this.mouseMoveTimeoutTimer = null;\n    this.asyncEndDragFrameId = null;\n    this.dragOverTargetIds = null;\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.registry = manager.getRegistry();\n    this.context = manager.getContext();\n  }\n\n  Object.defineProperty(HTML5Backend.prototype, \"window\", {\n    // public for test\n    get: function () {\n      if (this.context && this.context.window) {\n        return this.context.window;\n      } else if (typeof window !== 'undefined') {\n        return window;\n      }\n\n      return undefined;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  HTML5Backend.prototype.setup = function () {\n    if (this.window === undefined) {\n      return;\n    }\n\n    if (this.window.__isReactDndBackendSetUp) {\n      throw new Error('Cannot have two HTML5 backends at the same time.');\n    }\n\n    this.window.__isReactDndBackendSetUp = true;\n    this.addEventListeners(this.window);\n  };\n\n  HTML5Backend.prototype.teardown = function () {\n    if (this.window === undefined) {\n      return;\n    }\n\n    this.window.__isReactDndBackendSetUp = false;\n    this.removeEventListeners(this.window);\n    this.clearCurrentDragSourceNode();\n\n    if (this.asyncEndDragFrameId) {\n      this.window.cancelAnimationFrame(this.asyncEndDragFrameId);\n    }\n  };\n\n  HTML5Backend.prototype.connectDragPreview = function (sourceId, node, options) {\n    var _this = this;\n\n    this.sourcePreviewNodeOptions.set(sourceId, options);\n    this.sourcePreviewNodes.set(sourceId, node);\n    return function () {\n      _this.sourcePreviewNodes.delete(sourceId);\n\n      _this.sourcePreviewNodeOptions.delete(sourceId);\n    };\n  };\n\n  HTML5Backend.prototype.connectDragSource = function (sourceId, node, options) {\n    var _this = this;\n\n    this.sourceNodes.set(sourceId, node);\n    this.sourceNodeOptions.set(sourceId, options);\n\n    var handleDragStart = function (e) {\n      return _this.handleDragStart(e, sourceId);\n    };\n\n    var handleSelectStart = function (e) {\n      return _this.handleSelectStart(e);\n    };\n\n    node.setAttribute('draggable', true);\n    node.addEventListener('dragstart', handleDragStart);\n    node.addEventListener('selectstart', handleSelectStart);\n    return function () {\n      _this.sourceNodes.delete(sourceId);\n\n      _this.sourceNodeOptions.delete(sourceId);\n\n      node.removeEventListener('dragstart', handleDragStart);\n      node.removeEventListener('selectstart', handleSelectStart);\n      node.setAttribute('draggable', false);\n    };\n  };\n\n  HTML5Backend.prototype.connectDropTarget = function (targetId, node) {\n    var _this = this;\n\n    var handleDragEnter = function (e) {\n      return _this.handleDragEnter(e, targetId);\n    };\n\n    var handleDragOver = function (e) {\n      return _this.handleDragOver(e, targetId);\n    };\n\n    var handleDrop = function (e) {\n      return _this.handleDrop(e, targetId);\n    };\n\n    node.addEventListener('dragenter', handleDragEnter);\n    node.addEventListener('dragover', handleDragOver);\n    node.addEventListener('drop', handleDrop);\n    return function () {\n      node.removeEventListener('dragenter', handleDragEnter);\n      node.removeEventListener('dragover', handleDragOver);\n      node.removeEventListener('drop', handleDrop);\n    };\n  };\n\n  HTML5Backend.prototype.addEventListeners = function (target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.addEventListener) {\n      return;\n    }\n\n    target.addEventListener('dragstart', this.handleTopDragStart);\n    target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.addEventListener('dragenter', this.handleTopDragEnter);\n    target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.addEventListener('dragover', this.handleTopDragOver);\n    target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.addEventListener('drop', this.handleTopDrop);\n    target.addEventListener('drop', this.handleTopDropCapture, true);\n  };\n\n  HTML5Backend.prototype.removeEventListeners = function (target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.removeEventListener) {\n      return;\n    }\n\n    target.removeEventListener('dragstart', this.handleTopDragStart);\n    target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.removeEventListener('dragenter', this.handleTopDragEnter);\n    target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.removeEventListener('dragover', this.handleTopDragOver);\n    target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.removeEventListener('drop', this.handleTopDrop);\n    target.removeEventListener('drop', this.handleTopDropCapture, true);\n  };\n\n  HTML5Backend.prototype.getCurrentSourceNodeOptions = function () {\n    var sourceId = this.monitor.getSourceId();\n    var sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n    return defaults(sourceNodeOptions || {}, {\n      dropEffect: this.altKeyPressed ? 'copy' : 'move'\n    });\n  };\n\n  HTML5Backend.prototype.getCurrentDropEffect = function () {\n    if (this.isDraggingNativeItem()) {\n      // It makes more sense to default to 'copy' for native resources\n      return 'copy';\n    }\n\n    return this.getCurrentSourceNodeOptions().dropEffect;\n  };\n\n  HTML5Backend.prototype.getCurrentSourcePreviewNodeOptions = function () {\n    var sourceId = this.monitor.getSourceId();\n    var sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n    return defaults(sourcePreviewNodeOptions || {}, {\n      anchorX: 0.5,\n      anchorY: 0.5,\n      captureDraggingState: false\n    });\n  };\n\n  HTML5Backend.prototype.getSourceClientOffset = function (sourceId) {\n    return OffsetUtils_1.getNodeClientOffset(this.sourceNodes.get(sourceId));\n  };\n\n  HTML5Backend.prototype.isDraggingNativeItem = function () {\n    var itemType = this.monitor.getItemType();\n    return Object.keys(NativeTypes).some(function (key) {\n      return NativeTypes[key] === itemType;\n    });\n  };\n\n  HTML5Backend.prototype.beginDragNativeItem = function (type) {\n    this.clearCurrentDragSourceNode();\n    var SourceType = NativeDragSources_1.createNativeDragSource(type);\n    this.currentNativeSource = new SourceType();\n    this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n    this.actions.beginDrag([this.currentNativeHandle]);\n  };\n\n  HTML5Backend.prototype.endDragNativeItem = function () {\n    if (!this.isDraggingNativeItem()) {\n      return;\n    }\n\n    this.actions.endDrag();\n    this.registry.removeSource(this.currentNativeHandle);\n    this.currentNativeHandle = null;\n    this.currentNativeSource = null;\n  };\n\n  HTML5Backend.prototype.isNodeInDocument = function (node) {\n    // Check the node either in the main document or in the current context\n    return !!document && document.body.contains(node) || !!this.window && this.window.document.body.contains(node);\n  };\n\n  HTML5Backend.prototype.endDragIfSourceWasRemovedFromDOM = function () {\n    var node = this.currentDragSourceNode;\n\n    if (this.isNodeInDocument(node)) {\n      return;\n    }\n\n    if (this.clearCurrentDragSourceNode()) {\n      this.actions.endDrag();\n    }\n  };\n\n  HTML5Backend.prototype.setCurrentDragSourceNode = function (node) {\n    var _this = this;\n\n    this.clearCurrentDragSourceNode();\n    this.currentDragSourceNode = node;\n    this.currentDragSourceNodeOffset = OffsetUtils_1.getNodeClientOffset(node);\n    this.currentDragSourceNodeOffsetChanged = false; // A timeout of > 0 is necessary to resolve Firefox issue referenced\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n\n    var MOUSE_MOVE_TIMEOUT = 1000; // Receiving a mouse event in the middle of a dragging operation\n    // means it has ended and the drag source node disappeared from DOM,\n    // so the browser didn't dispatch the dragend event.\n    //\n    // We need to wait before we start listening for mousemove events.\n    // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n    // immediately in some browsers.\n    //\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n    //\n\n    this.mouseMoveTimeoutTimer = setTimeout(function () {\n      return _this.window && _this.window.addEventListener('mousemove', _this.endDragIfSourceWasRemovedFromDOM, true);\n    }, MOUSE_MOVE_TIMEOUT);\n  };\n\n  HTML5Backend.prototype.clearCurrentDragSourceNode = function () {\n    if (this.currentDragSourceNode) {\n      this.currentDragSourceNode = null;\n      this.currentDragSourceNodeOffset = null;\n      this.currentDragSourceNodeOffsetChanged = false;\n\n      if (this.window) {\n        this.window.clearTimeout(this.mouseMoveTimeoutTimer);\n        this.window.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n      }\n\n      this.mouseMoveTimeoutTimer = null;\n      return true;\n    }\n\n    return false;\n  };\n\n  HTML5Backend.prototype.checkIfCurrentDragSourceRectChanged = function () {\n    var node = this.currentDragSourceNode;\n\n    if (!node) {\n      return false;\n    }\n\n    if (this.currentDragSourceNodeOffsetChanged) {\n      return true;\n    }\n\n    this.currentDragSourceNodeOffsetChanged = !shallowEqual(OffsetUtils_1.getNodeClientOffset(node), this.currentDragSourceNodeOffset);\n    return this.currentDragSourceNodeOffsetChanged;\n  };\n\n  HTML5Backend.prototype.handleTopDragStartCapture = function () {\n    this.clearCurrentDragSourceNode();\n    this.dragStartSourceIds = [];\n  };\n\n  HTML5Backend.prototype.handleDragStart = function (e, sourceId) {\n    if (!this.dragStartSourceIds) {\n      this.dragStartSourceIds = [];\n    }\n\n    this.dragStartSourceIds.unshift(sourceId);\n  };\n\n  HTML5Backend.prototype.handleTopDragStart = function (e) {\n    var _this = this;\n\n    var dragStartSourceIds = this.dragStartSourceIds;\n    this.dragStartSourceIds = null;\n    var clientOffset = OffsetUtils_1.getEventClientOffset(e); // Avoid crashing if we missed a drop event or our previous drag died\n\n    if (this.monitor.isDragging()) {\n      this.actions.endDrag();\n    } // Don't publish the source just yet (see why below)\n\n\n    this.actions.beginDrag(dragStartSourceIds || [], {\n      publishSource: false,\n      getSourceClientOffset: this.getSourceClientOffset,\n      clientOffset: clientOffset\n    });\n    var dataTransfer = e.dataTransfer;\n    var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n\n    if (this.monitor.isDragging()) {\n      if (typeof dataTransfer.setDragImage === 'function') {\n        // Use custom drag image if user specifies it.\n        // If child drag source refuses drag but parent agrees,\n        // use parent's node as drag image. Neither works in IE though.\n        var sourceId = this.monitor.getSourceId();\n        var sourceNode = this.sourceNodes.get(sourceId);\n        var dragPreview = this.sourcePreviewNodes.get(sourceId) || sourceNode;\n\n        var _a = this.getCurrentSourcePreviewNodeOptions(),\n            anchorX = _a.anchorX,\n            anchorY = _a.anchorY,\n            offsetX = _a.offsetX,\n            offsetY = _a.offsetY;\n\n        var anchorPoint = {\n          anchorX: anchorX,\n          anchorY: anchorY\n        };\n        var offsetPoint = {\n          offsetX: offsetX,\n          offsetY: offsetY\n        };\n        var dragPreviewOffset = OffsetUtils_1.getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n        dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n      }\n\n      try {\n        // Firefox won't drag without setting data\n        dataTransfer.setData('application/json', {});\n      } catch (err) {// IE doesn't support MIME types in setData\n      } // Store drag source node so we can check whether\n      // it is removed from DOM and trigger endDrag manually.\n\n\n      this.setCurrentDragSourceNode(e.target); // Now we are ready to publish the drag source.. or are we not?\n\n      var captureDraggingState = this.getCurrentSourcePreviewNodeOptions().captureDraggingState;\n\n      if (!captureDraggingState) {\n        // Usually we want to publish it in the next tick so that browser\n        // is able to screenshot the current (not yet dragging) state.\n        //\n        // It also neatly avoids a situation where render() returns null\n        // in the same tick for the source element, and browser freaks out.\n        setTimeout(function () {\n          return _this.actions.publishDragSource();\n        }, 0);\n      } else {\n        // In some cases the user may want to override this behavior, e.g.\n        // to work around IE not supporting custom drag previews.\n        //\n        // When using a custom drag layer, the only way to prevent\n        // the default drag preview from drawing in IE is to screenshot\n        // the dragging state in which the node itself has zero opacity\n        // and height. In this case, though, returning null from render()\n        // will abruptly end the dragging, which is not obvious.\n        //\n        // This is the reason such behavior is strictly opt-in.\n        this.actions.publishDragSource();\n      }\n    } else if (nativeType) {\n      // A native item (such as URL) dragged from inside the document\n      this.beginDragNativeItem(nativeType);\n    } else if (!dataTransfer.types && (!e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n      // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n      // Just let it drag. It's a native type (URL or text) and will be picked up in\n      // dragenter handler.\n      return;\n    } else {\n      // If by this time no drag source reacted, tell browser not to drag.\n      e.preventDefault();\n    }\n  };\n\n  HTML5Backend.prototype.handleTopDragEndCapture = function () {\n    if (this.clearCurrentDragSourceNode()) {\n      // Firefox can dispatch this event in an infinite loop\n      // if dragend handler does something like showing an alert.\n      // Only proceed if we have not handled it already.\n      this.actions.endDrag();\n    }\n  };\n\n  HTML5Backend.prototype.handleTopDragEnterCapture = function (e) {\n    this.dragEnterTargetIds = [];\n    var isFirstEnter = this.enterLeaveCounter.enter(e.target);\n\n    if (!isFirstEnter || this.monitor.isDragging()) {\n      return;\n    }\n\n    var dataTransfer = e.dataTransfer;\n    var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n\n    if (nativeType) {\n      // A native item (such as file or URL) dragged from outside the document\n      this.beginDragNativeItem(nativeType);\n    }\n  };\n\n  HTML5Backend.prototype.handleDragEnter = function (e, targetId) {\n    this.dragEnterTargetIds.unshift(targetId);\n  };\n\n  HTML5Backend.prototype.handleTopDragEnter = function (e) {\n    var _this = this;\n\n    var dragEnterTargetIds = this.dragEnterTargetIds;\n    this.dragEnterTargetIds = [];\n\n    if (!this.monitor.isDragging()) {\n      // This is probably a native item type we don't understand.\n      return;\n    }\n\n    this.altKeyPressed = e.altKey;\n\n    if (!BrowserDetector_1.isFirefox()) {\n      // Don't emit hover in `dragenter` on Firefox due to an edge case.\n      // If the target changes position as the result of `dragenter`, Firefox\n      // will still happily dispatch `dragover` despite target being no longer\n      // there. The easy solution is to only fire `hover` in `dragover` on FF.\n      this.actions.hover(dragEnterTargetIds, {\n        clientOffset: OffsetUtils_1.getEventClientOffset(e)\n      });\n    }\n\n    var canDrop = dragEnterTargetIds.some(function (targetId) {\n      return _this.monitor.canDropOnTarget(targetId);\n    });\n\n    if (canDrop) {\n      // IE requires this to fire dragover events\n      e.preventDefault();\n      e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n    }\n  };\n\n  HTML5Backend.prototype.handleTopDragOverCapture = function () {\n    this.dragOverTargetIds = [];\n  };\n\n  HTML5Backend.prototype.handleDragOver = function (e, targetId) {\n    if (this.dragOverTargetIds === null) {\n      this.dragOverTargetIds = [];\n    }\n\n    this.dragOverTargetIds.unshift(targetId);\n  };\n\n  HTML5Backend.prototype.handleTopDragOver = function (e) {\n    var _this = this;\n\n    var dragOverTargetIds = this.dragOverTargetIds;\n    this.dragOverTargetIds = [];\n\n    if (!this.monitor.isDragging()) {\n      // This is probably a native item type we don't understand.\n      // Prevent default \"drop and blow away the whole document\" action.\n      e.preventDefault();\n      e.dataTransfer.dropEffect = 'none';\n      return;\n    }\n\n    this.altKeyPressed = e.altKey;\n    this.actions.hover(dragOverTargetIds || [], {\n      clientOffset: OffsetUtils_1.getEventClientOffset(e)\n    });\n    var canDrop = (dragOverTargetIds || []).some(function (targetId) {\n      return _this.monitor.canDropOnTarget(targetId);\n    });\n\n    if (canDrop) {\n      // Show user-specified drop effect.\n      e.preventDefault();\n      e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n    } else if (this.isDraggingNativeItem()) {\n      // Don't show a nice cursor but still prevent default\n      // \"drop and blow away the whole document\" action.\n      e.preventDefault();\n      e.dataTransfer.dropEffect = 'none';\n    } else if (this.checkIfCurrentDragSourceRectChanged()) {\n      // Prevent animating to incorrect position.\n      // Drop effect must be other than 'none' to prevent animation.\n      e.preventDefault();\n      e.dataTransfer.dropEffect = 'move';\n    }\n  };\n\n  HTML5Backend.prototype.handleTopDragLeaveCapture = function (e) {\n    if (this.isDraggingNativeItem()) {\n      e.preventDefault();\n    }\n\n    var isLastLeave = this.enterLeaveCounter.leave(e.target);\n\n    if (!isLastLeave) {\n      return;\n    }\n\n    if (this.isDraggingNativeItem()) {\n      this.endDragNativeItem();\n    }\n  };\n\n  HTML5Backend.prototype.handleTopDropCapture = function (e) {\n    this.dropTargetIds = [];\n    e.preventDefault();\n\n    if (this.isDraggingNativeItem()) {\n      this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer);\n    }\n\n    this.enterLeaveCounter.reset();\n  };\n\n  HTML5Backend.prototype.handleDrop = function (e, targetId) {\n    this.dropTargetIds.unshift(targetId);\n  };\n\n  HTML5Backend.prototype.handleTopDrop = function (e) {\n    var dropTargetIds = this.dropTargetIds;\n    this.dropTargetIds = [];\n    this.actions.hover(dropTargetIds, {\n      clientOffset: OffsetUtils_1.getEventClientOffset(e)\n    });\n    this.actions.drop({\n      dropEffect: this.getCurrentDropEffect()\n    });\n\n    if (this.isDraggingNativeItem()) {\n      this.endDragNativeItem();\n    } else {\n      this.endDragIfSourceWasRemovedFromDOM();\n    }\n  };\n\n  HTML5Backend.prototype.handleSelectStart = function (e) {\n    var target = e.target; // Only IE requires us to explicitly say\n    // we want drag drop operation to start\n\n    if (typeof target.dragDrop !== 'function') {\n      return;\n    } // Inputs and textareas should be selectable\n\n\n    if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n      return;\n    } // For other targets, ask IE\n    // to enable drag and drop\n\n\n    e.preventDefault();\n    target.dragDrop();\n  };\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"getSourceClientOffset\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"endDragNativeItem\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"isNodeInDocument\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"endDragIfSourceWasRemovedFromDOM\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragStartCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragStart\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragEndCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragEnterCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragEnter\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragOverCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragOver\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDragLeaveCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDropCapture\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleTopDrop\", null);\n\n  __decorate([autobind_decorator_1.default], HTML5Backend.prototype, \"handleSelectStart\", null);\n\n  return HTML5Backend;\n}();\n\nexports.default = HTML5Backend;","map":{"version":3,"sources":["/Users/lailysarvarian/a-kanban/client/node_modules/react-dnd-html5-backend/lib/HTML5Backend.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","exports","value","EnterLeaveCounter_1","require","BrowserDetector_1","OffsetUtils_1","NativeDragSources_1","NativeTypes","autobind_decorator_1","defaults","shallowEqual","HTML5Backend","manager","sourcePreviewNodes","Map","sourcePreviewNodeOptions","sourceNodes","sourceNodeOptions","enterLeaveCounter","default","dragStartSourceIds","dropTargetIds","dragEnterTargetIds","currentNativeSource","currentNativeHandle","currentDragSourceNode","currentDragSourceNodeOffset","currentDragSourceNodeOffsetChanged","altKeyPressed","mouseMoveTimeoutTimer","asyncEndDragFrameId","dragOverTargetIds","actions","getActions","monitor","getMonitor","registry","getRegistry","context","getContext","prototype","get","window","undefined","enumerable","configurable","setup","__isReactDndBackendSetUp","Error","addEventListeners","teardown","removeEventListeners","clearCurrentDragSourceNode","cancelAnimationFrame","connectDragPreview","sourceId","node","options","_this","set","delete","connectDragSource","handleDragStart","e","handleSelectStart","setAttribute","addEventListener","removeEventListener","connectDropTarget","targetId","handleDragEnter","handleDragOver","handleDrop","handleTopDragStart","handleTopDragStartCapture","handleTopDragEndCapture","handleTopDragEnter","handleTopDragEnterCapture","handleTopDragLeaveCapture","handleTopDragOver","handleTopDragOverCapture","handleTopDrop","handleTopDropCapture","getCurrentSourceNodeOptions","getSourceId","dropEffect","getCurrentDropEffect","isDraggingNativeItem","getCurrentSourcePreviewNodeOptions","anchorX","anchorY","captureDraggingState","getSourceClientOffset","getNodeClientOffset","itemType","getItemType","keys","some","beginDragNativeItem","type","SourceType","createNativeDragSource","addSource","beginDrag","endDragNativeItem","endDrag","removeSource","isNodeInDocument","document","body","contains","endDragIfSourceWasRemovedFromDOM","setCurrentDragSourceNode","MOUSE_MOVE_TIMEOUT","setTimeout","clearTimeout","checkIfCurrentDragSourceRectChanged","unshift","clientOffset","getEventClientOffset","isDragging","publishSource","dataTransfer","nativeType","matchNativeItemType","setDragImage","sourceNode","dragPreview","_a","offsetX","offsetY","anchorPoint","offsetPoint","dragPreviewOffset","getDragPreviewOffset","x","y","setData","err","publishDragSource","types","hasAttribute","preventDefault","isFirstEnter","enter","altKey","isFirefox","hover","canDrop","canDropOnTarget","isLastLeave","leave","mutateItemByReadingDataTransfer","reset","drop","dragDrop","tagName","isContentEditable"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EnterLeaveCounter_1 = require(\"./EnterLeaveCounter\");\nvar BrowserDetector_1 = require(\"./BrowserDetector\");\nvar OffsetUtils_1 = require(\"./OffsetUtils\");\nvar NativeDragSources_1 = require(\"./NativeDragSources\");\nvar NativeTypes = require(\"./NativeTypes\");\nvar autobind_decorator_1 = require(\"autobind-decorator\");\nvar defaults = require('lodash/defaults');\nvar shallowEqual = require('shallowequal');\nvar HTML5Backend = /** @class */ (function () {\n    function HTML5Backend(manager) {\n        this.sourcePreviewNodes = new Map();\n        this.sourcePreviewNodeOptions = new Map();\n        this.sourceNodes = new Map();\n        this.sourceNodeOptions = new Map();\n        this.enterLeaveCounter = new EnterLeaveCounter_1.default();\n        this.dragStartSourceIds = null;\n        this.dropTargetIds = [];\n        this.dragEnterTargetIds = [];\n        this.currentNativeSource = null;\n        this.currentNativeHandle = null;\n        this.currentDragSourceNode = null;\n        this.currentDragSourceNodeOffset = null;\n        this.currentDragSourceNodeOffsetChanged = false;\n        this.altKeyPressed = false;\n        this.mouseMoveTimeoutTimer = null;\n        this.asyncEndDragFrameId = null;\n        this.dragOverTargetIds = null;\n        this.actions = manager.getActions();\n        this.monitor = manager.getMonitor();\n        this.registry = manager.getRegistry();\n        this.context = manager.getContext();\n    }\n    Object.defineProperty(HTML5Backend.prototype, \"window\", {\n        // public for test\n        get: function () {\n            if (this.context && this.context.window) {\n                return this.context.window;\n            }\n            else if (typeof window !== 'undefined') {\n                return window;\n            }\n            return undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    HTML5Backend.prototype.setup = function () {\n        if (this.window === undefined) {\n            return;\n        }\n        if (this.window.__isReactDndBackendSetUp) {\n            throw new Error('Cannot have two HTML5 backends at the same time.');\n        }\n        this.window.__isReactDndBackendSetUp = true;\n        this.addEventListeners(this.window);\n    };\n    HTML5Backend.prototype.teardown = function () {\n        if (this.window === undefined) {\n            return;\n        }\n        this.window.__isReactDndBackendSetUp = false;\n        this.removeEventListeners(this.window);\n        this.clearCurrentDragSourceNode();\n        if (this.asyncEndDragFrameId) {\n            this.window.cancelAnimationFrame(this.asyncEndDragFrameId);\n        }\n    };\n    HTML5Backend.prototype.connectDragPreview = function (sourceId, node, options) {\n        var _this = this;\n        this.sourcePreviewNodeOptions.set(sourceId, options);\n        this.sourcePreviewNodes.set(sourceId, node);\n        return function () {\n            _this.sourcePreviewNodes.delete(sourceId);\n            _this.sourcePreviewNodeOptions.delete(sourceId);\n        };\n    };\n    HTML5Backend.prototype.connectDragSource = function (sourceId, node, options) {\n        var _this = this;\n        this.sourceNodes.set(sourceId, node);\n        this.sourceNodeOptions.set(sourceId, options);\n        var handleDragStart = function (e) { return _this.handleDragStart(e, sourceId); };\n        var handleSelectStart = function (e) { return _this.handleSelectStart(e); };\n        node.setAttribute('draggable', true);\n        node.addEventListener('dragstart', handleDragStart);\n        node.addEventListener('selectstart', handleSelectStart);\n        return function () {\n            _this.sourceNodes.delete(sourceId);\n            _this.sourceNodeOptions.delete(sourceId);\n            node.removeEventListener('dragstart', handleDragStart);\n            node.removeEventListener('selectstart', handleSelectStart);\n            node.setAttribute('draggable', false);\n        };\n    };\n    HTML5Backend.prototype.connectDropTarget = function (targetId, node) {\n        var _this = this;\n        var handleDragEnter = function (e) { return _this.handleDragEnter(e, targetId); };\n        var handleDragOver = function (e) { return _this.handleDragOver(e, targetId); };\n        var handleDrop = function (e) { return _this.handleDrop(e, targetId); };\n        node.addEventListener('dragenter', handleDragEnter);\n        node.addEventListener('dragover', handleDragOver);\n        node.addEventListener('drop', handleDrop);\n        return function () {\n            node.removeEventListener('dragenter', handleDragEnter);\n            node.removeEventListener('dragover', handleDragOver);\n            node.removeEventListener('drop', handleDrop);\n        };\n    };\n    HTML5Backend.prototype.addEventListeners = function (target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.addEventListener) {\n            return;\n        }\n        target.addEventListener('dragstart', this.handleTopDragStart);\n        target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.addEventListener('dragenter', this.handleTopDragEnter);\n        target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.addEventListener('dragover', this.handleTopDragOver);\n        target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.addEventListener('drop', this.handleTopDrop);\n        target.addEventListener('drop', this.handleTopDropCapture, true);\n    };\n    HTML5Backend.prototype.removeEventListeners = function (target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.removeEventListener) {\n            return;\n        }\n        target.removeEventListener('dragstart', this.handleTopDragStart);\n        target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.removeEventListener('dragenter', this.handleTopDragEnter);\n        target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.removeEventListener('dragover', this.handleTopDragOver);\n        target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.removeEventListener('drop', this.handleTopDrop);\n        target.removeEventListener('drop', this.handleTopDropCapture, true);\n    };\n    HTML5Backend.prototype.getCurrentSourceNodeOptions = function () {\n        var sourceId = this.monitor.getSourceId();\n        var sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n        return defaults(sourceNodeOptions || {}, {\n            dropEffect: this.altKeyPressed ? 'copy' : 'move',\n        });\n    };\n    HTML5Backend.prototype.getCurrentDropEffect = function () {\n        if (this.isDraggingNativeItem()) {\n            // It makes more sense to default to 'copy' for native resources\n            return 'copy';\n        }\n        return this.getCurrentSourceNodeOptions().dropEffect;\n    };\n    HTML5Backend.prototype.getCurrentSourcePreviewNodeOptions = function () {\n        var sourceId = this.monitor.getSourceId();\n        var sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n        return defaults(sourcePreviewNodeOptions || {}, {\n            anchorX: 0.5,\n            anchorY: 0.5,\n            captureDraggingState: false,\n        });\n    };\n    HTML5Backend.prototype.getSourceClientOffset = function (sourceId) {\n        return OffsetUtils_1.getNodeClientOffset(this.sourceNodes.get(sourceId));\n    };\n    HTML5Backend.prototype.isDraggingNativeItem = function () {\n        var itemType = this.monitor.getItemType();\n        return Object.keys(NativeTypes).some(function (key) { return NativeTypes[key] === itemType; });\n    };\n    HTML5Backend.prototype.beginDragNativeItem = function (type) {\n        this.clearCurrentDragSourceNode();\n        var SourceType = NativeDragSources_1.createNativeDragSource(type);\n        this.currentNativeSource = new SourceType();\n        this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n        this.actions.beginDrag([this.currentNativeHandle]);\n    };\n    HTML5Backend.prototype.endDragNativeItem = function () {\n        if (!this.isDraggingNativeItem()) {\n            return;\n        }\n        this.actions.endDrag();\n        this.registry.removeSource(this.currentNativeHandle);\n        this.currentNativeHandle = null;\n        this.currentNativeSource = null;\n    };\n    HTML5Backend.prototype.isNodeInDocument = function (node) {\n        // Check the node either in the main document or in the current context\n        return ((!!document && document.body.contains(node)) ||\n            (!!this.window && this.window.document.body.contains(node)));\n    };\n    HTML5Backend.prototype.endDragIfSourceWasRemovedFromDOM = function () {\n        var node = this.currentDragSourceNode;\n        if (this.isNodeInDocument(node)) {\n            return;\n        }\n        if (this.clearCurrentDragSourceNode()) {\n            this.actions.endDrag();\n        }\n    };\n    HTML5Backend.prototype.setCurrentDragSourceNode = function (node) {\n        var _this = this;\n        this.clearCurrentDragSourceNode();\n        this.currentDragSourceNode = node;\n        this.currentDragSourceNodeOffset = OffsetUtils_1.getNodeClientOffset(node);\n        this.currentDragSourceNodeOffsetChanged = false;\n        // A timeout of > 0 is necessary to resolve Firefox issue referenced\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        var MOUSE_MOVE_TIMEOUT = 1000;\n        // Receiving a mouse event in the middle of a dragging operation\n        // means it has ended and the drag source node disappeared from DOM,\n        // so the browser didn't dispatch the dragend event.\n        //\n        // We need to wait before we start listening for mousemove events.\n        // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n        // immediately in some browsers.\n        //\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        //\n        this.mouseMoveTimeoutTimer = setTimeout(function () {\n            return (_this.window &&\n                _this.window.addEventListener('mousemove', _this.endDragIfSourceWasRemovedFromDOM, true));\n        }, MOUSE_MOVE_TIMEOUT);\n    };\n    HTML5Backend.prototype.clearCurrentDragSourceNode = function () {\n        if (this.currentDragSourceNode) {\n            this.currentDragSourceNode = null;\n            this.currentDragSourceNodeOffset = null;\n            this.currentDragSourceNodeOffsetChanged = false;\n            if (this.window) {\n                this.window.clearTimeout(this.mouseMoveTimeoutTimer);\n                this.window.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n            }\n            this.mouseMoveTimeoutTimer = null;\n            return true;\n        }\n        return false;\n    };\n    HTML5Backend.prototype.checkIfCurrentDragSourceRectChanged = function () {\n        var node = this.currentDragSourceNode;\n        if (!node) {\n            return false;\n        }\n        if (this.currentDragSourceNodeOffsetChanged) {\n            return true;\n        }\n        this.currentDragSourceNodeOffsetChanged = !shallowEqual(OffsetUtils_1.getNodeClientOffset(node), this.currentDragSourceNodeOffset);\n        return this.currentDragSourceNodeOffsetChanged;\n    };\n    HTML5Backend.prototype.handleTopDragStartCapture = function () {\n        this.clearCurrentDragSourceNode();\n        this.dragStartSourceIds = [];\n    };\n    HTML5Backend.prototype.handleDragStart = function (e, sourceId) {\n        if (!this.dragStartSourceIds) {\n            this.dragStartSourceIds = [];\n        }\n        this.dragStartSourceIds.unshift(sourceId);\n    };\n    HTML5Backend.prototype.handleTopDragStart = function (e) {\n        var _this = this;\n        var dragStartSourceIds = this.dragStartSourceIds;\n        this.dragStartSourceIds = null;\n        var clientOffset = OffsetUtils_1.getEventClientOffset(e);\n        // Avoid crashing if we missed a drop event or our previous drag died\n        if (this.monitor.isDragging()) {\n            this.actions.endDrag();\n        }\n        // Don't publish the source just yet (see why below)\n        this.actions.beginDrag(dragStartSourceIds || [], {\n            publishSource: false,\n            getSourceClientOffset: this.getSourceClientOffset,\n            clientOffset: clientOffset,\n        });\n        var dataTransfer = e.dataTransfer;\n        var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n        if (this.monitor.isDragging()) {\n            if (typeof dataTransfer.setDragImage === 'function') {\n                // Use custom drag image if user specifies it.\n                // If child drag source refuses drag but parent agrees,\n                // use parent's node as drag image. Neither works in IE though.\n                var sourceId = this.monitor.getSourceId();\n                var sourceNode = this.sourceNodes.get(sourceId);\n                var dragPreview = this.sourcePreviewNodes.get(sourceId) || sourceNode;\n                var _a = this.getCurrentSourcePreviewNodeOptions(), anchorX = _a.anchorX, anchorY = _a.anchorY, offsetX = _a.offsetX, offsetY = _a.offsetY;\n                var anchorPoint = { anchorX: anchorX, anchorY: anchorY };\n                var offsetPoint = { offsetX: offsetX, offsetY: offsetY };\n                var dragPreviewOffset = OffsetUtils_1.getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n                dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n            }\n            try {\n                // Firefox won't drag without setting data\n                dataTransfer.setData('application/json', {});\n            }\n            catch (err) {\n                // IE doesn't support MIME types in setData\n            }\n            // Store drag source node so we can check whether\n            // it is removed from DOM and trigger endDrag manually.\n            this.setCurrentDragSourceNode(e.target);\n            // Now we are ready to publish the drag source.. or are we not?\n            var captureDraggingState = this.getCurrentSourcePreviewNodeOptions().captureDraggingState;\n            if (!captureDraggingState) {\n                // Usually we want to publish it in the next tick so that browser\n                // is able to screenshot the current (not yet dragging) state.\n                //\n                // It also neatly avoids a situation where render() returns null\n                // in the same tick for the source element, and browser freaks out.\n                setTimeout(function () { return _this.actions.publishDragSource(); }, 0);\n            }\n            else {\n                // In some cases the user may want to override this behavior, e.g.\n                // to work around IE not supporting custom drag previews.\n                //\n                // When using a custom drag layer, the only way to prevent\n                // the default drag preview from drawing in IE is to screenshot\n                // the dragging state in which the node itself has zero opacity\n                // and height. In this case, though, returning null from render()\n                // will abruptly end the dragging, which is not obvious.\n                //\n                // This is the reason such behavior is strictly opt-in.\n                this.actions.publishDragSource();\n            }\n        }\n        else if (nativeType) {\n            // A native item (such as URL) dragged from inside the document\n            this.beginDragNativeItem(nativeType);\n        }\n        else if (!dataTransfer.types &&\n            (!e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n            // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n            // Just let it drag. It's a native type (URL or text) and will be picked up in\n            // dragenter handler.\n            return;\n        }\n        else {\n            // If by this time no drag source reacted, tell browser not to drag.\n            e.preventDefault();\n        }\n    };\n    HTML5Backend.prototype.handleTopDragEndCapture = function () {\n        if (this.clearCurrentDragSourceNode()) {\n            // Firefox can dispatch this event in an infinite loop\n            // if dragend handler does something like showing an alert.\n            // Only proceed if we have not handled it already.\n            this.actions.endDrag();\n        }\n    };\n    HTML5Backend.prototype.handleTopDragEnterCapture = function (e) {\n        this.dragEnterTargetIds = [];\n        var isFirstEnter = this.enterLeaveCounter.enter(e.target);\n        if (!isFirstEnter || this.monitor.isDragging()) {\n            return;\n        }\n        var dataTransfer = e.dataTransfer;\n        var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n        if (nativeType) {\n            // A native item (such as file or URL) dragged from outside the document\n            this.beginDragNativeItem(nativeType);\n        }\n    };\n    HTML5Backend.prototype.handleDragEnter = function (e, targetId) {\n        this.dragEnterTargetIds.unshift(targetId);\n    };\n    HTML5Backend.prototype.handleTopDragEnter = function (e) {\n        var _this = this;\n        var dragEnterTargetIds = this.dragEnterTargetIds;\n        this.dragEnterTargetIds = [];\n        if (!this.monitor.isDragging()) {\n            // This is probably a native item type we don't understand.\n            return;\n        }\n        this.altKeyPressed = e.altKey;\n        if (!BrowserDetector_1.isFirefox()) {\n            // Don't emit hover in `dragenter` on Firefox due to an edge case.\n            // If the target changes position as the result of `dragenter`, Firefox\n            // will still happily dispatch `dragover` despite target being no longer\n            // there. The easy solution is to only fire `hover` in `dragover` on FF.\n            this.actions.hover(dragEnterTargetIds, {\n                clientOffset: OffsetUtils_1.getEventClientOffset(e),\n            });\n        }\n        var canDrop = dragEnterTargetIds.some(function (targetId) {\n            return _this.monitor.canDropOnTarget(targetId);\n        });\n        if (canDrop) {\n            // IE requires this to fire dragover events\n            e.preventDefault();\n            e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n        }\n    };\n    HTML5Backend.prototype.handleTopDragOverCapture = function () {\n        this.dragOverTargetIds = [];\n    };\n    HTML5Backend.prototype.handleDragOver = function (e, targetId) {\n        if (this.dragOverTargetIds === null) {\n            this.dragOverTargetIds = [];\n        }\n        this.dragOverTargetIds.unshift(targetId);\n    };\n    HTML5Backend.prototype.handleTopDragOver = function (e) {\n        var _this = this;\n        var dragOverTargetIds = this.dragOverTargetIds;\n        this.dragOverTargetIds = [];\n        if (!this.monitor.isDragging()) {\n            // This is probably a native item type we don't understand.\n            // Prevent default \"drop and blow away the whole document\" action.\n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'none';\n            return;\n        }\n        this.altKeyPressed = e.altKey;\n        this.actions.hover(dragOverTargetIds || [], {\n            clientOffset: OffsetUtils_1.getEventClientOffset(e),\n        });\n        var canDrop = (dragOverTargetIds || []).some(function (targetId) {\n            return _this.monitor.canDropOnTarget(targetId);\n        });\n        if (canDrop) {\n            // Show user-specified drop effect.\n            e.preventDefault();\n            e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n        }\n        else if (this.isDraggingNativeItem()) {\n            // Don't show a nice cursor but still prevent default\n            // \"drop and blow away the whole document\" action.\n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'none';\n        }\n        else if (this.checkIfCurrentDragSourceRectChanged()) {\n            // Prevent animating to incorrect position.\n            // Drop effect must be other than 'none' to prevent animation.\n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'move';\n        }\n    };\n    HTML5Backend.prototype.handleTopDragLeaveCapture = function (e) {\n        if (this.isDraggingNativeItem()) {\n            e.preventDefault();\n        }\n        var isLastLeave = this.enterLeaveCounter.leave(e.target);\n        if (!isLastLeave) {\n            return;\n        }\n        if (this.isDraggingNativeItem()) {\n            this.endDragNativeItem();\n        }\n    };\n    HTML5Backend.prototype.handleTopDropCapture = function (e) {\n        this.dropTargetIds = [];\n        e.preventDefault();\n        if (this.isDraggingNativeItem()) {\n            this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer);\n        }\n        this.enterLeaveCounter.reset();\n    };\n    HTML5Backend.prototype.handleDrop = function (e, targetId) {\n        this.dropTargetIds.unshift(targetId);\n    };\n    HTML5Backend.prototype.handleTopDrop = function (e) {\n        var dropTargetIds = this.dropTargetIds;\n        this.dropTargetIds = [];\n        this.actions.hover(dropTargetIds, {\n            clientOffset: OffsetUtils_1.getEventClientOffset(e),\n        });\n        this.actions.drop({ dropEffect: this.getCurrentDropEffect() });\n        if (this.isDraggingNativeItem()) {\n            this.endDragNativeItem();\n        }\n        else {\n            this.endDragIfSourceWasRemovedFromDOM();\n        }\n    };\n    HTML5Backend.prototype.handleSelectStart = function (e) {\n        var target = e.target;\n        // Only IE requires us to explicitly say\n        // we want drag drop operation to start\n        if (typeof target.dragDrop !== 'function') {\n            return;\n        }\n        // Inputs and textareas should be selectable\n        if (target.tagName === 'INPUT' ||\n            target.tagName === 'SELECT' ||\n            target.tagName === 'TEXTAREA' ||\n            target.isContentEditable) {\n            return;\n        }\n        // For other targets, ask IE\n        // to enable drag and drop\n        e.preventDefault();\n        target.dragDrop();\n    };\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"getSourceClientOffset\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"endDragNativeItem\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"isNodeInDocument\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"endDragIfSourceWasRemovedFromDOM\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragStartCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragStart\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragEndCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragEnterCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragEnter\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragOverCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragOver\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDragLeaveCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDropCapture\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleTopDrop\", null);\n    __decorate([\n        autobind_decorator_1.default\n    ], HTML5Backend.prototype, \"handleSelectStart\", null);\n    return HTML5Backend;\n}());\nexports.default = HTML5Backend;\n"]},"metadata":{},"sourceType":"script"}